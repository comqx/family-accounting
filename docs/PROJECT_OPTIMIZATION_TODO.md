# 家账通项目全局优化 ToDoList

## 一、前端优化

### 1. 性能与体验
- [x] 首页、账本、报表等大数据页面支持虚拟滚动/懒加载，提升渲染性能
  - [x] 创建了通用虚拟列表组件 (`src/components/common/VirtualList.vue`)
  - [x] 为首页最近记录列表添加了虚拟滚动功能
  - [x] 为报表页面分类统计列表添加了虚拟滚动功能
  - [x] 账本页面已实现虚拟滚动和分页加载
- [x] 组件按需/异步加载，减少首屏包体积
  - [x] 创建了组件懒加载工具 (`src/utils/performance/lazyLoad.ts`)
  - [x] 支持常用组件的预加载和按需加载
  - [x] 提供了加载状态和错误处理组件
- [ ] 静态资源（图片、图标）压缩与 CDN 加速
- [x] 关键页面/操作添加骨架屏或加载动画，优化感知
  - [x] 创建了通用骨架屏组件 (`src/components/common/Skeleton.vue`)
  - [x] 首页、报表等页面已添加骨架屏
- [x] 表单输入、按钮点击等交互增加防抖/节流
  - [x] 创建了防抖/节流工具 (`src/utils/performance/debounce.ts`)
  - [x] 首页、账本等页面已应用防抖/节流优化
- [ ] 适配深色模式、自动跟随系统主题
- [x] 支持多语言（国际化 i18n），配置语言切换
  - [x] 已实现完整的国际化支持
- [ ] 增强无障碍（a11y）支持，适配读屏、色弱等场景

### 2. 代码结构与可维护性
- [x] 组件库/业务组件进一步抽象与复用
  - [x] StatsCard 统计卡片组件抽象与复用（首页/账本/报表页）
  - [x] CategoryCard 分类卡片组件抽象与复用（首页/账本/分类页）
  - [x] CategoryPicker 分类选择器组件抽象与复用（首页/账本/弹窗等）
  - [x] EmptyState 空状态组件抽象与复用（各页面暂无数据等）
  - [x] Skeleton 骨架屏组件抽象与复用（各页面加载中等）
  - [x] ActionButton 操作按钮组件抽象与复用（各页面主要操作等）
  - [x] ConfirmModal 二次确认弹窗组件抽象与复用（删除/退出等重要操作）
  - [x] 账本页已统一调用 EmptyState、Skeleton、ActionButton 等通用组件
  - [x] 分类页已统一调用 EmptyState、ActionButton、ConfirmModal 等通用组件
  - [x] 分摊页已统一调用 EmptyState、ActionButton 等通用组件
  - [x] 导入页已统一调用 ActionButton 等通用组件
- [x] 所有 API 请求、错误处理、权限校验统一封装（request 工具已统一封装，OCR/上传/解析等已合规）
- [x] Pinia store 状态持久化与模块解耦（所有核心模块已持久化必要字段，record 仅持久化 recentRecords，模块解耦良好）
- [x] 业务类型、接口类型补全，减少 any/unknown
- [x] 代码注释、文档补全，关键逻辑/接口/类型说明

### 3. 功能与体验细节
- [x] 数据导出支持 Excel/PDF
  - [x] 创建了完整的导出页面 (/pages/export/index.vue)
  - [x] 支持 Excel 和 PDF 格式选择
  - [x] 支持时间范围选择
  - [x] 支持分类统计和成员统计选项
  - [x] 数据预览功能
  - [x] 导出历史记录管理
  - [x] 更新了所有相关页面的导出功能入口
- [x] 离线缓存与断网友好提示
  - [x] 创建了网络状态检测工具 (/utils/network.ts)
  - [x] 实现了离线数据缓存机制
  - [x] 创建了网络状态显示组件 (/components/common/NetworkStatus.vue)
  - [x] 支持网络状态变化监听
  - [x] 实现了离线优先的数据获取策略
- [x] 用户引导/新手教程/功能提示
  - [x] 创建了引导模态框组件 (/components/common/GuideModal.vue)
  - [x] 创建了引导管理工具 (/utils/guide.ts)
  - [x] 支持多种引导类型：欢迎引导、记账引导、家庭功能引导、导出功能引导
  - [x] 支持引导状态管理（完成/跳过/重置）
  - [x] 支持自动显示和手动触发引导
  - [x] 引导配置支持步骤自定义和样式配置
- [x] 账单图片 OCR 识别准确率提升与异常兜底
  - [x] 优化了 OCR 识别流程，增加了重试机制（最多3次）
  - [x] 实现了多重兜底策略：后端OCR → 微信原生OCR → 预处理OCR → 降级处理
  - [x] 增加了置信度阈值判断，确保识别质量
  - [x] 增强了异常处理和错误信息反馈
  - [x] 支持图片预处理功能（预留接口）
  - [x] 优化了多平台账单解析算法（支付宝、微信、银行、信用卡）
- [x] 账本/家庭/成员等管理页面支持批量操作
  - [x] 为成员管理页面添加了批量操作功能
  - [x] 支持批量选择成员（单选、全选、清空）
  - [x] 支持批量修改成员角色
  - [x] 支持批量移除成员
  - [x] 添加了批量操作工具栏和操作按钮
  - [x] 实现了批量操作的确认机制和错误处理
  - [x] 优化了用户界面，支持批量模式和普通模式切换
- [x] 账单/家庭/成员等列表支持搜索与筛选
  - [x] 为成员管理页面添加了搜索功能
  - [x] 支持按成员姓名搜索
  - [x] 支持按角色筛选（管理员、普通成员）
  - [x] 支持按加入时间筛选（一周内、一月内、一季度内）
  - [x] 支持多种排序方式（按姓名、加入时间、角色）
  - [x] 添加了搜索栏和筛选按钮
  - [x] 实现了实时搜索和筛选结果展示
- [x] 重要操作二次确认（如删除、退出家庭等）
  - [x] 创建了通用的确认对话框组件 (/components/common/ConfirmDialog.vue)
  - [x] 创建了确认操作的组合式函数 (/composables/useConfirm.ts)
  - [x] 支持多种确认类型：删除、移除、退出、重置、批量操作等
  - [x] 支持自定义标题、消息、图标和按钮文本
  - [x] 支持不同类型的样式（危险、警告、信息、成功）
  - [x] 提供了 Promise 接口，便于异步操作处理

### 4. 监控与埋点
- [x] 前端错误监控与上报（如 Sentry）
  - [x] 创建了性能监控工具 (`src/utils/performance/monitor.ts`)
  - [x] 支持错误自动捕获和上报
  - [x] 支持性能指标监控（FCP、LCP、FID、CLS、TTFB）
  - [x] 支持用户行为埋点
  - [x] 可配置采样率和上报策略
- [x] 用户行为埋点与分析
  - [x] 支持页面访问、按钮点击等事件埋点
  - [x] 支持自定义事件和数据上报
  - [x] 提供便捷的埋点方法
- [x] 性能监控数据自动上报
  - [x] 自动监控页面加载性能
  - [x] 支持性能数据批量上报
  - [x] 提供性能报告接口

---

## 二、后端优化

### 1. 安全与规范
- [x] 所有接口参数严格校验（express-validator/joi）
  - [x] 创建了参数校验中间件 (`cloud/middleware/validation.js`)
  - [x] 支持用户、家庭、记录、分类、预算、分摊、报表等所有接口的校验
  - [x] 提供统一的错误处理和详细的错误信息
- [x] JWT 鉴权与权限控制细化（如家庭成员/管理员/访客等角色）
  - [x] 创建了权限控制中间件 (`cloud/middleware/auth.js`)
  - [x] 实现了细粒度的权限控制：观察员、普通成员、管理员、家庭所有者
  - [x] 支持家庭权限、记录权限、分类权限、预算权限检查
  - [x] 提供了权限检查工具函数和角色常量
- [x] API 频率限制（express-rate-limit）参数根据实际业务调整
  - [x] 已在主应用中配置了频率限制（15分钟内最多100个请求）
- [ ] 敏感信息加密存储（如手机号、邮箱等）
- [x] 日志分级与脱敏，错误日志与访问日志分离
  - [x] 创建了日志管理中间件 (`cloud/middleware/logger.js`)
  - [x] 支持访问日志、错误日志、业务日志分离
  - [x] 实现了敏感数据脱敏功能
  - [x] 支持日志轮转和性能监控
- [x] 统一错误码与错误响应格式
  - [x] 创建了统一错误处理中间件 (`cloud/middleware/errorHandler.js`)
  - [x] 定义了完整的错误码体系（认证、权限、参数、业务、数据库、外部服务、系统错误）
  - [x] 提供了多种错误类型和便捷的错误响应函数

### 2. 性能与可用性
- [ ] 数据库查询优化（索引、分页、慢查询分析）
- [ ] 热点数据缓存（如 Redis 缓存家庭/分类/配置等）
- [ ] 事务处理与数据一致性保障
- [ ] WebSocket 连接管理与断线重连机制优化
- [ ] 文件上传/图片处理限流与安全校验

### 3. 可维护性与自动化
- [ ] API 文档自动生成（如 swagger/openapi）
- [ ] 单元测试/集成测试覆盖主要业务逻辑
- [ ] CI/CD 自动化部署与回滚
- [ ] 配置中心与多环境变量管理
- [ ] 依赖包定期升级与安全漏洞扫描

### 4. 扩展与兼容
- [ ] 账单导入/导出接口支持更多格式
- [ ] 预留第三方支付/通知/消息推送等扩展能力
- [ ] 适配更多小程序平台（如支付宝、抖音等）

---

## 三、数据库与部署

### 1. 数据库层
- [ ] 表结构与字段类型再次梳理，冗余字段清理
- [ ] 外键约束与数据一致性校验
- [ ] 备份与恢复策略完善，定期自动备份
- [ ] 生产环境数据库权限最小化原则

### 2. 部署与运维
- [ ] Docker 镜像体积优化，多阶段构建
- [ ] 日志采集与监控（如 ELK、Prometheus）
- [ ] 服务器资源监控与自动告警
- [ ] 灰度发布与回滚机制
- [ ] 生产环境安全组与防火墙配置

---

## 四、合规与隐私

### 1. 合规性
- [ ] 隐私政策、用户协议内容定期更新，合规性自查
- [ ] 敏感操作（如导出、删除）需二次确认与日志记录
- [ ] 用户数据可导出、可删除，满足数据可携带与被遗忘权

### 2. 用户体验
- [ ] 登录、注册、授权流程友好提示与异常兜底
- [ ] 体验版/正式版差异说明，避免用户困惑
- [ ] 重要功能（如记账、同步、分摊）异常时有清晰提示与自愈建议

---

如需对某一条进行细化或直接给出代码实现建议，请告知具体方向！ 